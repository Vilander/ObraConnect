# ğŸ¨ FLUXOGRAMAS E DIAGRAMAS DO SISTEMA

## 1. FLUXOGRAMA DE AUTENTICAÃ‡ÃƒO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FLUXO DE LOGIN                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   UsuÃ¡rio
      â”‚
      â”‚ Acessa /login
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tela de Login      â”‚
â”‚  (Frontend)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Input: login, senha
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/login                   â”‚
â”‚ {login, senha}                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: authController.login()        â”‚
â”‚ 1. Buscar usuÃ¡rio no BD                â”‚
â”‚ 2. Validar senha com bcrypt            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
    â–¼ (Erro)     â–¼ (OK)
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ 401     â”‚ â”‚ 200 OK               â”‚
 â”‚ Login   â”‚ â”‚ {token, usuario}     â”‚
 â”‚ invÃ¡lidoâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                        â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ localStorage:      â”‚
                â”‚ - token            â”‚
                â”‚ - usuario          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Redireciona para   â”‚
                â”‚ PÃ¡gina Inicial     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. FLUXOGRAMA DE CADASTRO DE SERVIÃ‡O

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CRIAR NOVO SERVIÃ‡O                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Prestador Logado
      â”‚
      â”‚ Clica em "Novo ServiÃ§o"
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CadastrarServico.jsx           â”‚
â”‚ FormulÃ¡rio (Frontend)          â”‚
â”‚ - Nome                         â”‚
â”‚ - DescriÃ§Ã£o                    â”‚
â”‚ - Categorias (mÃºltiplas)       â”‚
â”‚ - Telefone                     â”‚
â”‚ - Imagem URL                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Preenche e Clica em "Salvar"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validar dados (Joi)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ (Erro)        (Sucesso)
    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mostrarâ”‚    â”‚POST /api/servicos    â”‚
â”‚ Erros  â”‚    â”‚ {dados do serviÃ§o}   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Token no Header
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Backend:             â”‚
              â”‚ servicoController    â”‚
              â”‚ 1. Validar token     â”‚
              â”‚ 2. Validar dados     â”‚
              â”‚ 3. Inserir em        â”‚
              â”‚    tb_servico        â”‚
              â”‚ 4. Inserir em        â”‚
              â”‚    tb_categoria_     â”‚
              â”‚    atendida          â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ (Erro)   (Sucesso)
                â–¼              â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ 400/500â”‚    â”‚ 201 Created     â”‚
           â”‚ Erro   â”‚    â”‚ {id, dados}     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Salva em         â”‚
                        â”‚ localStorage     â”‚
                        â”‚ Mostra mensagem  â”‚
                        â”‚ "Sucesso"        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Redireciona para â”‚
                        â”‚ Meus ServiÃ§os    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. FLUXOGRAMA DE CRIAÃ‡ÃƒO DE AVALIAÃ‡ÃƒO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DEIXAR UMA AVALIAÃ‡ÃƒO                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   UsuÃ¡rio Logado vÃª um ServiÃ§o
      â”‚
      â”‚ Clica em "Avaliar"
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DetalheServico.jsx             â”‚
â”‚ FormulÃ¡rio de AvaliaÃ§Ã£o        â”‚
â”‚ (4 campos de 1-5)              â”‚
â”‚ - Nota PreÃ§o                   â”‚
â”‚ - Nota Tempo de ExecuÃ§Ã£o       â”‚
â”‚ - Nota Higiene                 â”‚
â”‚ - Nota EducaÃ§Ã£o                â”‚
â”‚ + Campo de ComentÃ¡rio          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ UsuÃ¡rio seleciona notas
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Clica em "Enviar AvaliaÃ§Ã£o"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/avaliacoes           â”‚
â”‚ {id_servico, notas, comentario}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend:                       â”‚
â”‚ 1. Verificar token             â”‚
â”‚ 2. Validar dados               â”‚
â”‚ 3. Verificar se serviÃ§o existe â”‚
â”‚ 4. Inserir avaliaÃ§Ã£o           â”‚
â”‚ 5. RECALCULAR nota_media       â”‚
â”‚    UPDATE tb_servico SET       â”‚
â”‚    nota_media = (nova mÃ©dia)   â”‚
â”‚    total_avaliacoes += 1       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ (Erro)   (Sucesso)
    â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 400/401â”‚    â”‚ 201 Created     â”‚
â”‚ Erro   â”‚    â”‚ {avaliacao}     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Frontend atualiza:   â”‚
            â”‚ - Lista de aval.     â”‚
            â”‚ - Nota mÃ©dia         â”‚
            â”‚ - Total de aval.     â”‚
            â”‚ Mostra "Sucesso"     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. FLUXOGRAMA DE LISTAGEM DE SERVIÃ‡OS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LISTAR SERVIÃ‡OS (com Filtros)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   UsuÃ¡rio acessa Inicio.jsx
      â”‚
      â”‚ PÃ¡gina carrega
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/servicos              â”‚
â”‚ ?categoria=123&pagina=1        â”‚
â”‚ (sem autenticaÃ§Ã£o obrigatÃ³ria) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend:                       â”‚
â”‚ 1. Validar query params        â”‚
â”‚ 2. SELECT tb_servico WHERE     â”‚
â”‚    ativo = 1                   â”‚
â”‚    AND categoria_id = ?        â”‚
â”‚ 3. JOIN com tb_categoria_      â”‚
â”‚    atendida                    â”‚
â”‚ 4. Aplicar LIMIT/OFFSET        â”‚
â”‚    (paginaÃ§Ã£o)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 200 OK                         â”‚
â”‚ {                              â”‚
â”‚   servicos: [                  â”‚
â”‚     {                          â”‚
â”‚       id, nome_prestador,      â”‚
â”‚       desc_servico,            â”‚
â”‚       imagem_url,              â”‚
â”‚       nota_media,              â”‚
â”‚       total_avaliacoes,        â”‚
â”‚       categorias: [...]        â”‚
â”‚     }, ...                     â”‚
â”‚   ],                           â”‚
â”‚   total: 45,                   â”‚
â”‚   pagina: 1                    â”‚
â”‚ }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Inicio.jsx           â”‚
â”‚ Renderiza cards de serviÃ§os    â”‚
â”‚ Com paginaÃ§Ã£o                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. MODELO DE DADOS - CONSULTAS IMPORTANTES

### Consulta 1: Buscar ServiÃ§o com Categorias

```sql
SELECT
  s.id,
  s.nome_prestador,
  s.desc_servico,
  s.imagem_url,
  s.email,
  s.telefone_contato,
  s.nota_media,
  s.total_avaliacoes,
  GROUP_CONCAT(c.nome_categoria SEPARATOR ',') AS categorias
FROM tb_servico s
LEFT JOIN tb_categoria_atendida ca ON s.id = ca.id_servico
LEFT JOIN tb_categoria c ON ca.id_categoria = c.id
WHERE s.id = ? AND s.ativo = 1
GROUP BY s.id;
```

### Consulta 2: Buscar AvaliaÃ§Ãµes de um ServiÃ§o

```sql
SELECT
  a.id,
  a.nota_preco,
  a.nota_tempo_execucao,
  a.nota_higiene,
  a.nota_educacao,
  a.comentario,
  u.nome_usuario,
  a.data_avaliacao
FROM tb_avaliacao a
JOIN tb_usuario u ON a.id_usuario = u.id
WHERE a.id_servico = ?
ORDER BY a.data_avaliacao DESC;
```

### Consulta 3: Recalcular Nota MÃ©dia

```sql
UPDATE tb_servico SET
  nota_media = (
    SELECT AVG((nota_preco + nota_tempo_execucao + nota_higiene + nota_educacao) / 4)
    FROM tb_avaliacao
    WHERE id_servico = ?
  ),
  total_avaliacoes = (
    SELECT COUNT(*)
    FROM tb_avaliacao
    WHERE id_servico = ?
  )
WHERE id = ?;
```

### Consulta 4: ServiÃ§os de um Prestador

```sql
SELECT
  s.id,
  s.nome_prestador,
  s.desc_servico,
  s.nota_media,
  s.total_avaliacoes,
  s.ativo,
  s.data_cadastro
FROM tb_servico s
WHERE s.id_usuario = ?
ORDER BY s.data_cadastro DESC;
```

---

## 6. ARQUITETURA DE AUTENTICAÃ‡ÃƒO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Frontend     â”‚
â”‚  (React)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ localStorage:   â”‚
â”‚ - token (JWT)   â”‚
â”‚ - usuario       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Header: Authorization: Bearer <token>
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend (Express)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Recebe request                â”‚
â”‚ 2. Middleware autenticacao       â”‚
â”‚    - Extrai token do header      â”‚
â”‚    - Verifica com JWT_SECRET     â”‚
â”‚    - Se vÃ¡lido: req.usuario = {} â”‚
â”‚    - Se invÃ¡lido: 401            â”‚
â”‚ 3. Controller acessa req.usuario â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       â”‚
    â–¼ (Token invÃ¡lido)   â–¼ (OK)
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ 401            â”‚   â”‚ Continua     â”‚
 â”‚ Unauthorized   â”‚   â”‚ ExecuÃ§Ã£o     â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estrutura do JWT (Token)

```
Header.Payload.Signature

Payload contÃ©m:
{
  "id": 5,
  "login": "pedro_eng",
  "email": "pedro@email.com",
  "tipo_usuario": "prestador",
  "iat": 1705760000,
  "exp": 1705846400
}

VÃ¡lido por: 24 horas (configurÃ¡vel)
```

---

## 7. ESTRUTURA DE RESPOSTA DA API

### Sucesso (200, 201)

```json
{
  "sucesso": true,
  "mensagem": "DescriÃ§Ã£o do que foi realizado",
  "dados": {
    "id": 1,
    "campo1": "valor1",
    "campo2": "valor2"
  }
}
```

### Erro (400, 401, 403, 500)

```json
{
  "sucesso": false,
  "mensagem": "DescriÃ§Ã£o do erro",
  "codigo": "CODIGO_ERRO",
  "erros": ["Campo 1 Ã© obrigatÃ³rio", "Email invÃ¡lido"]
}
```

---

## 8. PERMISSÃ•ES POR TIPO DE USUÃRIO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MATRIZ DE PERMISSÃ•ES                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Funcionalidadeâ”‚   UsuÃ¡rio    â”‚ Prestador    â”‚    Admin      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ver serviÃ§os â”‚      âœ…      â”‚      âœ…      â”‚      âœ…       â”‚
â”‚ Criar serv.  â”‚      âŒ      â”‚      âœ…      â”‚      âœ…       â”‚
â”‚ Editar serv. â”‚      âŒ*     â”‚      âœ…*     â”‚      âœ…       â”‚
â”‚ Deletar serv.â”‚      âŒ      â”‚      âœ…*     â”‚      âœ…       â”‚
â”‚ Avaliar      â”‚      âœ…      â”‚      âœ…      â”‚      âœ…       â”‚
â”‚ Ver aval. recâ”‚      âŒ      â”‚      âœ…      â”‚      âœ…       â”‚
â”‚ Gerenciar catâ”‚      âŒ      â”‚      âŒ      â”‚      âœ…       â”‚
â”‚ Gerenciar usrâ”‚      âŒ      â”‚      âŒ      â”‚      âœ…       â”‚
â”‚ Ver relatÃ³riosâ”‚     âŒ      â”‚      âœ…      â”‚      âœ…       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

* = Apenas seus prÃ³prios recursos
```

---

## 9. CICLO DE VIDA DE UMA AVALIAÃ‡ÃƒO

```
1. CRIAÃ‡ÃƒO
   â”œâ”€ UsuÃ¡rio seleciona 4 notas (1-5)
   â”œâ”€ Escreve comentÃ¡rio (opcional)
   â””â”€ Clica em "Enviar"

2. VALIDAÃ‡ÃƒO
   â”œâ”€ Backend valida token
   â”œâ”€ Backend valida dados
   â”œâ”€ Verifica se serviÃ§o existe
   â””â”€ Verifica se jÃ¡ existe avaliaÃ§Ã£o (prevent duplicata)

3. ARMAZENAMENTO
   â”œâ”€ Insere em tb_avaliacao
   â””â”€ Atualiza nota_media de tb_servico

4. CÃLCULO DE MÃ‰DIA
   â”œâ”€ Busca todas as avaliaÃ§Ãµes do serviÃ§o
   â”œâ”€ Calcula: (nota_preco + nota_tempo + nota_higiene + nota_educacao) / 4 para cada
   â”œâ”€ MÃ©dia final = mÃ©dia de todas
   â””â”€ Atualiza tb_servico.nota_media

5. EXIBIÃ‡ÃƒO
   â”œâ”€ Frontend busca GET /api/servicos/:id/avaliacoes
   â”œâ”€ Mostra lista com avaliaÃ§Ãµes mais recentes
   â”œâ”€ Exibe nota mÃ©dia no card do serviÃ§o
   â””â”€ Atualiza total_avaliacoes
```

---

## 10. FLUXO COMPLETO: NOVO USUÃRIO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        JORNADA DO NOVO USUÃRIO (Prestador)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ETAPA 1: REGISTRO
  â”œâ”€ Acessa /login
  â”œâ”€ Clica em "Criar conta"
  â”œâ”€ Preenche: login, email, senha, nome, tipo=prestador
  â”œâ”€ API POST /auth/registro
  â””â”€ âœ… Recebe token JWT

ETAPA 2: REDIRECIONAMENTO
  â”œâ”€ Token salvo em localStorage
  â”œâ”€ Redirecionado para InÃ­cio
  â””â”€ Header mostra nome do usuÃ¡rio

ETAPA 3: CRIAR PRIMEIRO SERVIÃ‡O
  â”œâ”€ Clica em "Novo ServiÃ§o"
  â”œâ”€ Preenche formulÃ¡rio:
  â”‚  â”œâ”€ Nome do serviÃ§o
  â”‚  â”œâ”€ DescriÃ§Ã£o detalhada
  â”‚  â”œâ”€ Seleciona categorias (mÃºltiplas)
  â”‚  â”œâ”€ Insere URL de imagem
  â”‚  â””â”€ Telefone para contato
  â”œâ”€ API POST /api/servicos
  â””â”€ âœ… ServiÃ§o criado com id = 1

ETAPA 4: ESPERAR AVALIAÃ‡Ã•ES
  â”œâ”€ UsuÃ¡rios encontram seu serviÃ§o
  â”œâ”€ Deixam avaliaÃ§Ãµes
  â”œâ”€ Sua nota_media aumenta
  â””â”€ ReputaÃ§Ã£o melhora = mais clientes

ETAPA 5: VER RESULTADOS
  â”œâ”€ Clica em "Minhas AvaliaÃ§Ãµes"
  â”œâ”€ VÃª todas as avaliaÃ§Ãµes recebidas
  â”œâ”€ VÃª pontuaÃ§Ã£o em cada dimensÃ£o
  â””â”€ Pode responder (funcionalidade futura)
```

---

**Ãšltima atualizaÃ§Ã£o**: 20 de janeiro de 2026
